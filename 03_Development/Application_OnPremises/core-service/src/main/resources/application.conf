ktor {
    deployment {
        port = 8080
        port = ${?PORT}
        watch = [ classes ]
    }
    application {
        modules = [ com.fmps.autotrader.core.ApplicationKt.module ]
    }
}

database {
    # SQLite Configuration
    driver = "org.sqlite.JDBC"
    url = "jdbc:sqlite:./data/autotrader.db"
    url = ${?DATABASE_URL}
    
    # HikariCP Connection Pool Settings
    hikari {
        maximumPoolSize = 10
        minimumIdle = 2
        idleTimeout = 600000  # 10 minutes
        connectionTimeout = 30000  # 30 seconds
        maxLifetime = 1800000  # 30 minutes
        autoCommit = true
        poolName = "AutoTraderPool"
        
        # SQLite specific settings
        dataSourceProperties {
            cachePrepStmts = true
            prepStmtCacheSize = 250
            prepStmtCacheSqlLimit = 2048
            useServerPrepStmts = true
        }
    }
    
    # Flyway Migration Settings
    flyway {
        baselineOnMigrate = true
        baselineVersion = "0"
        locations = [ "classpath:db/migration" ]
        validateOnMigrate = true
        cleanDisabled = true
    }
}

app {
    # Application Settings
    name = "FMPS AutoTrader"
    version = "1.0-SNAPSHOT"
    environment = "development"
    environment = ${?APP_ENV}
    host = "0.0.0.0"
    host = ${?APP_HOST}
    port = 8080
    port = ${?APP_PORT}
    
    # AI Trader Configuration
    aiTrader {
        maxInstances = 3
        defaultLeverage = 10
        defaultStopLoss = 0.02  # 2%
        defaultTakeProfit = 0.05  # 5%
    }
    
    # Exchange Configuration
    exchanges {
        binance {
            testnet = true
            baseUrl = "https://testnet.binance.vision"
            apiKey = ${?BINANCE_API_KEY}
            apiSecret = ${?BINANCE_API_SECRET}
        }
        bitget {
            testnet = true
            baseUrl = "https://api.bitget.com"
            apiKey = ${?BITGET_API_KEY}
            apiSecret = ${?BITGET_API_SECRET}
            passphrase = ${?BITGET_PASSPHRASE}
        }
        tradingview {
            webhookPort = 8081
            webhookPath = "/webhook/tradingview"
            apiKey = ${?TRADINGVIEW_API_KEY}
        }
    }
    
    # Logging Configuration
    logging {
        level = "INFO"
        level = ${?LOG_LEVEL}
        format = "json"
        outputPath = "./logs"
    }
}

