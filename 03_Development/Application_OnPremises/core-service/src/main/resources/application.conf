# FMPS AutoTrader Application - Main Configuration
# This file contains the base configuration for the application
# Environment-specific overrides are in application-{env}.conf files

# Include reference configuration (defaults)
include "reference.conf"

# Application Information
app {
    name = "FMPS AutoTrader"
    version = "1.0.0-SNAPSHOT"
    environment = "dev"  # Override with -Dapp.environment=prod
}

# Server Configuration
server {
    host = "0.0.0.0"
    host = ${?SERVER_HOST}
    
    port = 8080
    port = ${?SERVER_PORT}
    
    # Request handling
    requestTimeout = 60s
    connectionTimeout = 30s
    
    # CORS settings
    cors {
        enabled = true
        allowedHosts = ["localhost", "127.0.0.1"]
    }
    
    # WebSocket configuration
    websocket {
        enabled = true
        pingIntervalMs = 30000
        timeoutMs = 60000
        maxFrameSize = 1048576  # 1MB
    }
}

# Database Configuration
database {
    # SQLite database path
    path = "data/autotrader.db"
    path = ${?DB_PATH}
    
    # Connection pool settings (HikariCP)
    pool {
        maximumPoolSize = 10
        minimumIdle = 2
        connectionTimeout = 30000
        idleTimeout = 600000
        maxLifetime = 1800000
    }
    
    # Migration settings
    migration {
        enabled = true
        cleanOnValidationError = false
        validateOnMigrate = true
    }
}

# Logging Configuration
logging {
    level = "INFO"
    level = ${?LOG_LEVEL}
    
    # Log file settings
    file {
        enabled = true
        path = "logs"
        maxSize = "10MB"
        maxHistory = 7
        totalSizeCap = "1GB"
    }
    
    # Console logging
    console {
        enabled = true
        colorOutput = true
    }
    
    # Package-specific levels
    loggers {
        "com.fmps.autotrader" = "INFO"
        "io.ktor" = "INFO"
        "org.jetbrains.exposed" = "WARN"
        "com.zaxxer.hikari" = "INFO"
        "org.flywaydb" = "INFO"
    }
}

# Exchange Configurations
exchanges {
    # Binance Configuration
    binance {
        enabled = false  # Disabled by default (demo mode)
        
        api {
            key = ""  # Set via BINANCE_API_KEY environment variable
            key = ${?BINANCE_API_KEY}
            
            secret = ""  # Set via BINANCE_API_SECRET environment variable
            secret = ${?BINANCE_API_SECRET}
            
            baseUrl = "https://testnet.binance.vision"  # Testnet by default
            baseUrl = ${?BINANCE_BASE_URL}
            
            websocketUrl = "wss://testnet.binance.vision/ws"
            websocketUrl = ${?BINANCE_WS_URL}
        }
        
        # Rate limiting
        rateLimit {
            requestsPerMinute = 1200
            requestsPerSecond = 20
            orderLimitPerDay = 200000
        }
        
        # Retry settings
        retry {
            maxAttempts = 3
            initialDelayMs = 1000
            maxDelayMs = 10000
            multiplier = 2.0
        }
    }
    
    # Bitget Configuration
    bitget {
        enabled = false  # Disabled by default (demo mode)
        
        api {
            key = ""  # Set via BITGET_API_KEY environment variable
            key = ${?BITGET_API_KEY}
            
            secret = ""  # Set via BITGET_API_SECRET environment variable
            secret = ${?BITGET_API_SECRET}
            
            passphrase = ""  # Set via BITGET_PASSPHRASE environment variable
            passphrase = ${?BITGET_PASSPHRASE}
            
            baseUrl = "https://api.bitget.com"
            baseUrl = ${?BITGET_BASE_URL}
            
            websocketUrl = "wss://ws.bitget.com/mix/v1/stream"
            websocketUrl = ${?BITGET_WS_URL}
        }
        
        # Rate limiting
        rateLimit {
            requestsPerMinute = 600
            requestsPerSecond = 10
        }
        
        # Retry settings
        retry {
            maxAttempts = 3
            initialDelayMs = 1000
            maxDelayMs = 10000
            multiplier = 2.0
        }
    }
}

# AI Trader Defaults
aiTrader {
    # Maximum number of concurrent traders
    maxActiveTraders = 3
    
    # Default risk management settings
    defaultRisk {
        maxLeverage = 10
        defaultStopLossPercentage = 0.02  # 2%
        defaultTakeProfitPercentage = 0.05  # 5%
        maxDailyLossPercentage = 0.10  # 10%
        positionSizePercentage = 0.30  # 30% of balance per position
        minProfitLossRatio = 2.0  # Min 2:1 reward/risk ratio
    }
    
    # Default strategy settings
    defaultStrategy {
        analysisPeriod = 1h
        minConfidenceScore = 0.70  # 70%
        patternsRequired = 2
    }
    
    # Performance monitoring
    monitoring {
        updateIntervalMs = 5000
        alertOnLoss = true
        alertThreshold = -0.05  # Alert if loss > 5%
    }
}

# Trading Configuration
trading {
    # Demo mode settings
    demoMode {
        enabled = true  # Always true for v1.0
        initialBalance = 10000.0  # Virtual USD
        allowRealTrading = false
    }
    
    # Market data refresh intervals
    marketData {
        candlestickRefreshMs = 60000  # 1 minute
        orderBookRefreshMs = 5000  # 5 seconds
        tickerRefreshMs = 2000  # 2 seconds
    }
    
    # Order settings
    orders {
        defaultTimeoutMs = 30000
        retryFailedOrders = true
        maxRetries = 3
    }
}

# Security Configuration
security {
    # API key encryption
    encryption {
        enabled = true
        algorithm = "AES/GCM/NoPadding"
        keySize = 256
    }
    
    # Session management
    session {
        timeoutMinutes = 60
        extendOnActivity = true
    }
}

# Performance & Monitoring
performance {
    # Thread pool settings
    threadPool {
        corePoolSize = 4
        maxPoolSize = 16
        queueCapacity = 100
        keepAliveSeconds = 60
    }
    
    # Metrics collection
    metrics {
        enabled = true
        collectionIntervalMs = 60000
        retentionDays = 30
    }
    
    # Health check
    healthCheck {
        enabled = true
        intervalSeconds = 30
    }
}
