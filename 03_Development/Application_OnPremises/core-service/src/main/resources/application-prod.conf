# Production Environment Configuration
# Production-ready settings with security and performance optimizations

include "application.conf"

app {
    environment = "production"
}

server {
    host = "0.0.0.0"
    port = 8080
    
    requestTimeout = 120s  # Longer timeout for production
    connectionTimeout = 60s
    
    cors {
        enabled = true
        allowedHosts = []  # Must be configured via environment variables
    }
    
    websocket {
        enabled = true
        pingIntervalMs = 30000
        timeoutMs = 60000
        maxFrameSize = 1048576
    }
}

database {
    url = "jdbc:sqlite:/var/lib/fmps-autotrader/data/autotrader.db"  # Absolute path for production
    url = ${?DB_URL}
    
    hikari {
        maximumPoolSize = 20  # Larger pool for production
        minimumIdle = 5
        connectionTimeout = 30000
        idleTimeout = 600000
        maxLifetime = 1800000
    }
    
    flyway {
        cleanDisabled = true  # Never allow clean in production
    }
}

logging {
    level = "INFO"
    level = ${?LOG_LEVEL}
    
    console {
        enabled = true
        colorOutput = false  # No color in production logs
    }
    
    file {
        enabled = true
        path = "/var/log/fmps-autotrader"  # Standard log location
        path = ${?LOG_PATH}
        maxSize = "50MB"  # Larger files in production
        maxHistory = 30  # Keep more history
        totalSizeCap = "5GB"
    }
    
    loggers {
        "com.fmps.autotrader" = "INFO"
        "io.ktor" = "WARN"
        "org.jetbrains.exposed" = "WARN"
        "com.zaxxer.hikari" = "WARN"
        "org.flywaydb" = "INFO"
    }
}

exchanges {
    binance {
        enabled = false  # Enable only when ready for production
        enabled = ${?BINANCE_ENABLED}
        
        api {
            # API keys MUST be set via environment variables
            key = ${?BINANCE_API_KEY}
            secret = ${?BINANCE_API_SECRET}
            
            baseUrl = "https://api.binance.com"  # Production API
            baseUrl = ${?BINANCE_BASE_URL}
            
            websocketUrl = "wss://stream.binance.com:9443/ws"
            websocketUrl = ${?BINANCE_WS_URL}
        }
        
        rateLimit {
            requestsPerMinute = 1200
            requestsPerSecond = 20
            orderLimitPerDay = 200000
        }
    }
    
    bitget {
        enabled = false  # Enable only when ready for production
        enabled = ${?BITGET_ENABLED}
        
        api {
            # API keys MUST be set via environment variables
            key = ${?BITGET_API_KEY}
            secret = ${?BITGET_API_SECRET}
            passphrase = ${?BITGET_PASSPHRASE}
            
            baseUrl = "https://api.bitget.com"
            baseUrl = ${?BITGET_BASE_URL}
            
            websocketUrl = "wss://ws.bitget.com/mix/v1/stream"
            websocketUrl = ${?BITGET_WS_URL}
        }
        
        rateLimit {
            requestsPerMinute = 600
            requestsPerSecond = 10
        }
    }
}

aiTrader {
    maxActiveTraders = 3
    
    defaultRisk {
        maxLeverage = 10
        defaultStopLossPercentage = 0.02
        defaultTakeProfitPercentage = 0.05
        maxDailyLossPercentage = 0.10
        positionSizePercentage = 0.30
        minProfitLossRatio = 2.0
    }
    
    monitoring {
        updateIntervalMs = 5000
        alertOnLoss = true
        alertThreshold = -0.05
    }
}

trading {
    demoMode {
        enabled = true  # Always demo mode for v1.0
        initialBalance = 10000.0
        allowRealTrading = false  # Safety: never allow real money in v1.0
    }
    
    marketData {
        candlestickRefreshMs = 60000
        orderBookRefreshMs = 5000
        tickerRefreshMs = 2000
    }
    
    orders {
        defaultTimeoutMs = 30000
        retryFailedOrders = true
        maxRetries = 3
    }
}

security {
    encryption {
        enabled = true  # Always encrypt sensitive data in production
        algorithm = "AES/GCM/NoPadding"
        keySize = 256
    }
    
    session {
        timeoutMinutes = 120  # Longer session in production
        extendOnActivity = true
    }
}

performance {
    threadPool {
        corePoolSize = 8  # More threads for production
        maxPoolSize = 32
        queueCapacity = 200
        keepAliveSeconds = 60
    }
    
    metrics {
        enabled = true
        collectionIntervalMs = 60000
        retentionDays = 90  # Keep metrics longer in production
    }
    
    healthCheck {
        enabled = true
        intervalSeconds = 60
    }
}

