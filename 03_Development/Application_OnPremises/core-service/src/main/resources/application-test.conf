# Test Environment Configuration
# Configuration for unit and integration tests

include "application.conf"

app {
    environment = "test"
}

server {
    port = 0  # Random port for testing
    
    cors {
        enabled = true
        allowedHosts = ["*"]  # Allow all in tests
    }
    
    websocket {
        enabled = false  # Disable WebSocket in tests
    }
}

database {
    driver = "org.sqlite.JDBC"
    url = "jdbc:sqlite:build/test-db/autotrader-test.db"
    
    hikari {
        maximumPoolSize = 2
        minimumIdle = 1
        connectionTimeout = 10000
        idleTimeout = 300000
        maxLifetime = 900000
        autoCommit = true
        poolName = "AutoTrader-Test-HikariPool"
    }
    
    flyway {
        locations = ["classpath:db/migration"]
        baselineOnMigrate = true
        baselineVersion = "1"
        validateOnMigrate = true
        cleanDisabled = false  # Allow clean in tests
    }
}

logging {
    level = "WARN"  # Reduce noise in test output
    
    console {
        enabled = true
        colorOutput = false
    }
    
    file {
        enabled = false  # No file logging in tests
    }
    
    loggers {
        "com.fmps.autotrader" = "WARN"
        "io.ktor" = "WARN"
        "org.jetbrains.exposed" = "WARN"
        "com.zaxxer.hikari" = "WARN"
        "org.flywaydb" = "WARN"
    }
}

exchanges {
    binance {
        enabled = false  # Always disabled in tests
    }
    
    bitget {
        enabled = false  # Always disabled in tests
    }
}

aiTrader {
    maxActiveTraders = 3
    
    defaultRisk {
        maxLeverage = 5
        defaultStopLossPercentage = 0.02
        defaultTakeProfitPercentage = 0.05
        maxDailyLossPercentage = 0.10
        positionSizePercentage = 0.30
        minProfitLossRatio = 2.0
    }
    
    monitoring {
        updateIntervalMs = 1000  # Fast updates in tests
        alertOnLoss = false  # No alerts in tests
    }
}

trading {
    demoMode {
        enabled = true
        initialBalance = 10000.0
        allowRealTrading = false  # Never allow real trading in tests
    }
    
    marketData {
        candlestickRefreshMs = 1000  # Fast refresh for tests
        orderBookRefreshMs = 500
        tickerRefreshMs = 500
    }
    
    orders {
        defaultTimeoutMs = 5000  # Shorter timeouts in tests
        retryFailedOrders = false  # No retries in tests
        maxRetries = 1
    }
}

security {
    encryption {
        enabled = false  # Simplified testing
    }
    session {
        timeoutMinutes = 10
        extendOnActivity = false
    }
    api {
        keys = ["test-api-key"]
    }
}

performance {
    threadPool {
        corePoolSize = 2
        maxPoolSize = 4
        queueCapacity = 50
    }
    
    metrics {
        enabled = false  # Disable metrics in tests
    }
    
    healthCheck {
        enabled = false  # Disable health check in tests
    }
}

